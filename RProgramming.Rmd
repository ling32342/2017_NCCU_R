---
title: "R Programming"
author: "Peng-Wen Lin (Source from Johnson Hsieh)"
output:
  ioslides_presentation:
    css: css/dsp.css
    self_contained: no
    widescreen: yes
  slidy_presentation: default
---

## About me
<div style='float:left;width:60%;'>
__國立政治大學統計所碩二  林芃彣__

#### __Experience__
<p>
  * 健保資料庫分析團隊
  * 給軟體工程師的R語言精要班助教
  * D4SG資料英雄計畫 #3
  * 無象限有限公司實習生(2017.10-now)
  * 2017 第一屆政大資料競賽 亞軍
  * 2017 亞洲跨國黑客松決賽 最佳黑客獎
  * 2017 台電能源永續黑客松 第三名
</div>

<div style='float:left;width:40%;'>
<br>

#### __Skills__
<p>
  * R
  * SQL Server
</div>

<div style='float:left;width:40%;'>

#### __Contact me__
<p>
  * [Github](https://github.com/pongponglin)
  * [Linkin](https://www.linkedin.com/in/peng-wen-lin-309839153/)
  * nicole19940331@gmail.com
</div>

## 上禮拜要會的事

- 建立 R 的使用環境
- 熟悉 R 語言基礎操作
    - 敘述句、數列
    - 查詢說明檔
- 了解 R 語言的物件的結構
    - 變數型態：logical、numeric、character、factor
    - 資料存放容器：list、data.frame

## 這禮拜目標

- 體會 R 語言的流程控制
- 學習 R 語言的資料整理
- 確立 R 語言的資料爬析概念

## 資料處理流程

- 資料採集\
- 資料清洗處理\
- 統計及分析\
- 視覺呈現\
- 報告產出\
\
\
<p style="color:#0000C6;font-size:36px;">這些都是R可以辦到的事情！</p>


# Ch01：表格型文件的輸入與輸出
```{r setup, include=FALSE, cache=FALSE}
library(knitr)
library(magrittr)
library(xtable)
library(dplyr)
library(ggplot2)
opts_chunk$set(echo = TRUE, cache=TRUE, comment="", cache.path = ".cache-EDA/")
fig <- function(path, size = 100) {
  sprintf("<img src='img/%s' style='max-width: %d%%;max-height: %d%%'></img>", 
          path, size, size)
}
fig2 <- function(path, size = 100) {
  sprintf("<img src='img/%s' style='width: %d%%'></img>", 
          path, size)
}
sys_name <- Sys.info()["sysname"] %>% tolower
sys_encode <- c("utf8", "utf8", "big5")[pmatch(sys_name, c("linux", "darwin", "windows"))]
sessionInfo() %>% capture.output %>% cat(file = "sessionInfo.log", sep = "\n")
```

## 讀取檔案
- 在資料處理之前

<p style="color:#0000C6;font-size:36px;">先搞定怎麼把資料讀進來！</p>

</br>

- 在讀取資料進來之前

<p style="color:#0000C6;font-size:36px;">先搞清楚所在路徑位置！</p>

## 淺談路徑設定  
- `getwd` 查詢目前所在的資料夾路徑 (絕對路徑)
- `setwd` 設定所在的資料夾路徑 <br> (Session -> Set Working Directory -> Choose Directory)
- 檔案 (檔案路徑 file directory) vs. 資料夾 (工作路徑 working directory)
```{r echo=TRUE, eval=TRUE}
getwd()
```
```{r eval=FALSE}
# Mac
setwd("/Users/apple/nicole/R code")
# Windows 若複製路徑記得要改斜線！
# D:\桌面\PONG\Rcode
setwd("D:/桌面/PONG/Rcode")

dat <- read.csv("hsb.csv")
```

## 讀取表格檔案
讀取自己電腦裡的csv檔/txt檔
```{r echo=TRUE, eval=FALSE}
# 方法1. 透過介面選擇檔案所在路徑
path <- file.choose()
dat <- read.csv(path)

# 方法2. 自行輸入檔案絕對路徑
path <- "/Volumes/LEEF SURGE/LearnR/hsb.csv"
dat <- read.csv(path)

dat <- read.table("/Volumes/LEEF SURGE/LearnR/hsb.txt")

# 方法3. 相對路徑
dat <- read.csv("hsb.csv")
dat <- read.table("hsb.txt")
```

## 讀取表格檔案
- 下載範例資料
  https://pongponglin.github.io/2017NCCU_R/data/hsb.csv (點擊即會下載)
- 利用`read.csv` 讀取 `csv` 檔 (一種以逗點分隔欄位的資料格式)    

```{r echo=TRUE, eval=FALSE}
# 可以使用R指令來下載
url <- "https://pongponglin.github.io/2017NCCU_R/data/hsb.csv"
download.file(url, destfile = "hsb.csv") # 把檔案另存成hbs.csv
dat <- read.csv("hsb.csv")
head(dat)
```

```{r echo=FALSE}
dat <- read.csv("data/hsb.csv")
head(dat)
```

## 排解疑難1 - 路徑錯誤
```{r echo=TRUE, eval=FALSE}
path <- "wrong_file_path"
dat <- read.csv(file = path)
```
<pre>
Error in file(file, "rt") : 無法開啟連結
此外: Warning message:
  In file(file, "rt") : 無法開啟檔案 'wrong_file_path' ：No such file or directory
</pre>
- 絕對路徑 -> 確認檔案是否存在
- 相對路徑 -> 利用`getwd`了解R 當下的路徑位置

## 排解疑難2 - 格式錯誤
```{r echo=TRUE, eval=FALSE}
path <- "hsb.csv"
dat <- read.csv(file = path, header = TRUE, sep = "1")
```
<pre>
Error in read.table(file = file, header = header, sep = sep, quote = quote,  : 
  more columns than column names
</pre>
- 利用其他編輯器確認分隔符號
- 確認每列的資料的欄位是正確的
- 必要時，請用其他文件編輯器校正欲讀取的檔案

## 排解疑難3 - 編碼錯誤 

```{r echo=TRUE}
url <- "https://pongponglin.github.io/2017NCCU_R/%E8%B2%B7%E8%B3%A3st_A_10109_10109.csv"
```
```{r echo=TRUE, eval=FALSE}
dat <- read.csv(url)
```
<pre class="code">
Error in make.names(col.names, unique = TRUE) : 
  無效的多位元組字串於 <b6>m<c2><ed><a5><ab><b0><cf>
</pre>
- 查詢檔案的編碼
- 常見的中文編碼有UTF-8和BIG-5

```{r echo=TRUE, eval=FALSE}
# 利用`fileEncoding`參數選擇檔案編碼 - big5 / utf8
dat2 <- read.csv(url, fileEncoding = "utf8")
```

## 輸出表格檔案
利用`write.csv`將`data.frame`格式的R物件另存成csv檔
```{r echo=TRUE, eval=FALSE}
write.csv(dat, "hsb_new.csv", row.names=FALSE, fileEncoding = "utf8")
```

## 讀取其他軟體資料集
- For SPSS and Stata datasets, use the `foreign` package
- Cars: [Cars.sav](http://calcnet.mth.cmich.edu/org/spss/V16_materials/DataSets_v16/Cars.sav)
- Milk Production: [p004.dat](http://www.ats.ucla.edu/stat/stata/examples/chp/p004.dta)
```{r}
# install.packages("foreign") # 安裝R套件 foreign
library(foreign) # 載入套件 
cars <- read.spss("data/Cars.sav", to.data.frame = TRUE)
milk <- read.dta("data/p004.dta")
# head(cars)
# head(milk)
```

## 讀取其他軟體資料集
- For SAS datasets, use the `sas7bdat` package
- airline: [airline.sas7bdat](http://www.principlesofeconometrics.com/sas/airline.sas7bdat)

```{r}
# install.packages("sas7bdat")
library(sas7bdat)
airline <- read.sas7bdat("data/airline.sas7bdat")
head(airline)
```

# Ch02：讀取網頁內容(Lite)

## 逐行輸入與輸出
- `readLines`
- `writeLines`
- 讀取網頁原始碼的好工具

```{r echo=TRUE}
output <- file("data/output.txt")
writeLines(as.character(1:12), con = output)
input <- readLines(output)
input
```

## 逐行輸入與輸出
- `readLines`也可以用來讀取檔案

```{r echo=TRUE}
readLines("data/hsb.csv", n=5, encoding = "utf8")
```

## 練習
從[網頁中](http://www.buzzhand.com/post_365903.html)，找出藝人官方身高
```{r}
web_page <- readLines("http://www.buzzhand.com/post_365903.html")
matches <- gregexpr("[\u4E00-\u9FA5]+官方身高：[0-9]+cm", web_page)
tmp <- regmatches(web_page, matches)
unlist(tmp)
```

>其中：
[\u4E00-\u9FA5] 表示所有中文字符 ; [0-9] 含數字之字串 ; [a]+ 一或多個 a

## 進階練習
找出[清心福全](http://www.319papago.idv.tw/lifeinfo/chingshin/chingshin-02.html)台北市南港店的地址
```{r echo=TRUE}
# gregexpr要怎麼用？輸入：?gregexpr
web_page <- readLines("http://www.319papago.idv.tw/lifeinfo/chingshin/chingshin-02.html")
matches <- gregexpr("台北市南港區[\u4E00-\u9FA5|0-9|(|)]+", web_page)
tmp <- regmatches(web_page, matches)
unlist(tmp) # 把 list 轉成 vector
```

## 小挑戰
- 找出清心福全台北市門市的電話號碼
- 提示：`"02-[0-9]+"`

## 小挑戰
- 找出清心福全台北市門市的電話號碼
- 提示：`"02-[0-9]+"`

### 參考解答
```{r echo=TRUE}
web_page <- readLines("http://www.319papago.idv.tw/lifeinfo/chingshin/chingshin-02.html")
matches <- gregexpr("02-[0-9]+", web_page)
tmp <- regmatches(web_page, matches)
unlist(tmp) 
```

## 補充資料
- [Learn R in R (Swirls)](https://github.com/wush978/DataScienceAndR)
- [Data Wrangling Cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)
- [Introduction to dplyr](https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html)
- [An Introduction to reshape2](http://seananderson.ca/2013/10/19/reshape.html)
- [Cookbook for R](http://www.cookbook-r.com/)

## 繼續學習之路
- 了解自己的需求，詢問關鍵字與函數
- [Taiwan R User Group](http://www.meetup.com/Taiwan-R)，mailing list: Taiwan-useR-Group-list@meetup.com
- [ptt R_Language版](https://www.ptt.cc/bbs/R_Language/index.html)
- [R軟體使用者論壇](https://groups.google.com/forum/#!forum/taiwanruser)
- [StackOverflow](http://stackoverflow.com/) 
- 歡迎來信  ling32342@gmail.com  、 lillian60222@gmail.com 與我們一起交流！